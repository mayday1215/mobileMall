{"version":3,"sources":["webpack:///src/pages/search.vue","webpack:///./src/pages/search.vue?64c9","webpack:///./src/pages/search.vue"],"names":["search","data","searchKey","cateId","filterIndex","categoryList","id","text","value","filterList","orderBy","page","total","isLoading","list","timeout","mounted","_this","this","$refs","focus","$axios","get","then","res","errcode","forEach","item","name","concat","computed","by","arr","split","length","order","methods","_this2","clearTimeout","setTimeout","getData","handleScroll","clientHeight","scrollTop","scrollHeight","_this3","params","key","category_id","totalPages","pages_search","render","_vm","_h","$createElement","_c","_self","attrs","left-arrow","left-text","on","click-left","$event","$router","back","ref","slot","placeholder","keyup","model","callback","$$v","expression","_v","options","change","staticClass","scroll","_l","index","to","directives","rawName","_s","price","color","_e","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"www4/js/5.d6f5e6f287733ddce649.js","sourcesContent":["<template>\r\n  <div>\r\n    <van-nav-bar left-arrow left-text=\"返回\" @click-left=\"$router.back()\">\r\n      <van-field v-model=\"searchKey\" @keyup=\"search\" placeholder=\"请输入关键字\" slot=\"title\" ref=\"search\" />\r\n    </van-nav-bar>\r\n    <van-dropdown-menu>\r\n      <van-dropdown-item @change=\"search\" v-model=\"cateId\" :options=\"categoryList\" />\r\n      <van-dropdown-item @change=\"search\" v-model=\"orderBy\" :options=\"filterList\" />\r\n    </van-dropdown-menu>\r\n    <div class=\"list\" @scroll=\"handleScroll\" ref=\"list\">\r\n        <router-link :to=\"`/product/${item.id}`\" class=\"item\" v-for=\"(item, index) in list\" :key=\"`product-${item.id}`\">\r\n        <img v-lazy=\"item.cover\">\r\n        <h3>{{item.name}}</h3>\r\n        <div class=\"price clearfix\">\r\n          <span class=\"price-l\">￥</span>\r\n          <span class=\"cprice\">{{item.price}}</span>\r\n          <span class=\"price-r\">起</span>\r\n        </div>\r\n      </router-link>\r\n      <van-loading v-if=\"isLoading\" color=\"#1989fa\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        searchKey: '',\r\n        cateId: 0,\r\n        filterIndex: 0,\r\n        categoryList: [{ id: 0, text: '全部', value: 0 }],\r\n        filterList: [{text:'默认时间降序', value:'create_time,desc'}, {text:'价格降序', value:'price,desc'}, {text:'销量降序', value:'sales,desc'}],\r\n        orderBy:'create_time,desc',\r\n        page: 1,\r\n        total: 1,\r\n        isLoading: false,\r\n        list: [],\r\n        timeout: null\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$refs.search.focus()\r\n      this.$axios.get('/category/all').then(res => {\r\n        if (res.errcode === 0) {\r\n          res.data.forEach(item => {\r\n            item.text = item.name\r\n            item.value = item.id\r\n          })\r\n          this.categoryList = this.categoryList.concat(res.data)\r\n        }\r\n      })\r\n    },\r\n    computed: {\r\n      by() {\r\n        let arr = this.orderBy.split(',')\r\n        return arr.length == 2 ? arr[0] : ''\r\n      },\r\n      order() {\r\n        let arr = this.orderBy.split(',')\r\n        return arr.length == 2 ? arr[1] : ''\r\n      }\r\n    },\r\n    methods: {\r\n      search() {\r\n        // 每次搜索之前都把之前的搜索定时器清除了 (专业名称叫防抖)\r\n        clearTimeout(this.timeout)\r\n        this.timeout = setTimeout(() => {\r\n          this.list = []\r\n          this.page = 1\r\n          this.total = 1\r\n          this.isLoading = true\r\n          this.getData()\r\n        }, 500)\r\n      },\r\n      handleScroll() {\r\n        if (this.page == this.total) {\r\n          return\r\n        }\r\n        if (this.isLoading) {\r\n          return\r\n        }\r\n        if (this.$refs.list.clientHeight + this.$refs.list.scrollTop === this.$refs.list.scrollHeight) {\r\n          this.isLoading = true\r\n          this.page++\r\n          this.getData()\r\n        }\r\n      },\r\n      getData() {\r\n        let params = {\r\n          page: this.page,\r\n          key: this.searchKey\r\n        }\r\n        if(this.cateId > 0){\r\n          params.category_id = this.cateId\r\n        }\r\n        if(this.order){\r\n          params.order = this.order\r\n        }\r\n        if(this.by){\r\n          params.by = this.by\r\n        }\r\n        this.$axios.get(`/product/pagination`, {\r\n          params\r\n        }).then(res => {\r\n          if (res.errcode == 0) {\r\n            let data = res.data\r\n            this.total = data.totalPages\r\n            this.list = this.list.concat(data.data)\r\n          }\r\n          this.isLoading = false\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n<style scoped>\r\n.van-loading {\r\n    text-align: center;\r\n    padding-bottom: 20px;\r\n  }\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/search.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('van-nav-bar',{attrs:{\"left-arrow\":\"\",\"left-text\":\"返回\"},on:{\"click-left\":function($event){return _vm.$router.back()}}},[_c('van-field',{ref:\"search\",attrs:{\"slot\":\"title\",\"placeholder\":\"请输入关键字\"},on:{\"keyup\":_vm.search},slot:\"title\",model:{value:(_vm.searchKey),callback:function ($$v) {_vm.searchKey=$$v},expression:\"searchKey\"}})],1),_vm._v(\" \"),_c('van-dropdown-menu',[_c('van-dropdown-item',{attrs:{\"options\":_vm.categoryList},on:{\"change\":_vm.search},model:{value:(_vm.cateId),callback:function ($$v) {_vm.cateId=$$v},expression:\"cateId\"}}),_vm._v(\" \"),_c('van-dropdown-item',{attrs:{\"options\":_vm.filterList},on:{\"change\":_vm.search},model:{value:(_vm.orderBy),callback:function ($$v) {_vm.orderBy=$$v},expression:\"orderBy\"}})],1),_vm._v(\" \"),_c('div',{ref:\"list\",staticClass:\"list\",on:{\"scroll\":_vm.handleScroll}},[_vm._l((_vm.list),function(item,index){return _c('router-link',{key:(\"product-\" + (item.id)),staticClass:\"item\",attrs:{\"to\":(\"/product/\" + (item.id))}},[_c('img',{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:(item.cover),expression:\"item.cover\"}]}),_vm._v(\" \"),_c('h3',[_vm._v(_vm._s(item.name))]),_vm._v(\" \"),_c('div',{staticClass:\"price clearfix\"},[_c('span',{staticClass:\"price-l\"},[_vm._v(\"￥\")]),_vm._v(\" \"),_c('span',{staticClass:\"cprice\"},[_vm._v(_vm._s(item.price))]),_vm._v(\" \"),_c('span',{staticClass:\"price-r\"},[_vm._v(\"起\")])])])}),_vm._v(\" \"),(_vm.isLoading)?_c('van-loading',{attrs:{\"color\":\"#1989fa\"}}):_vm._e()],2)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-d5486f32\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/search.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-d5486f32\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./search.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./search.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./search.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-d5486f32\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./search.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-d5486f32\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/search.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}